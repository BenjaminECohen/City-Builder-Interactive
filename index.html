<!doctype html>
<html lang="us">

<head>

  <title>City Builder Interactive</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

  <script src="Build/UnityLoader.js"></script>
  <script src="codebird.js"></script>
  <script>
    var unityInstance = UnityLoader.instantiate("game", "Build/City Builder Beta 2.3.json");

  </script>

  <style>
    #modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgb(0, 0, 0);
      background-color: rgba(0, 0, 0, 0.4);
    }

    .modal-content {
      background-color: #fefefe;
      margin: 15% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

  </style>
</head>

<body style="margin: 0 auto">
  <div class="wrapper">
    <div class="nav" style="display: flex; flex: wrap; padding: 10px; background-color: lightgray; justify-content: center">
      <h3>CITY BUILDER INTERACTIVE DEV</h3>
    </div>
    <div class="content" style="display: flex;flex-direction: column;">
      <div class="game-container" style="width: 1280px; height: 720px; margin-left: auto; margin-right: auto; margin-top: 50px">
        <div id="game" style="width: 1280px; height: 720px;">
        </div>
        <div class="links" style="text-align: center; margin-top: 10px">
          <button id="twitter" class="post">Post to Twitter</button>
          <button class="post">Post to Facebook</button>
        </div>
      </div>

      <div id="modal">
        <span class="close">&times</span>
        <div class="modal-content">
          <p>Facebook or Twitter post functionality should go here</p>
          <iframe src="twitterPost.html"></iframe>
        </div>
      </div>
      <script type="text/javascript">
        //TWITTER STUFF
        $(function() {
          $("#twitter").click(function(e) {
            e.preventDefault();

            var cb = new Codebird;
            cb.setConsumerKey("g4DPwXTPfJXGw8U7KvEAIyccR", "63XQLkXjJaa0GroBNF8w81iG5DH9VwodhbycwV3l5urKYLaMjE");

            //OAuth request token
            cb.__call("oauth_requestToken", {
              oauth_callback: "oob"
            }, function(
              reply,
              rate,
              err
            ) {
              if (err) {
                console.log("error response or timeout exceeded: " + err.error);
              }
              if (reply) {
                console.log("reply:", reply)

                if (reply.errors && reply.errors["415"]) {
                  // check your callback URL
                  console.log(reply.errors["415"]);
                  return;
                }



                // stores the token
                cb.setToken(reply.oauth_token, reply.oauth_token_secret);

                localStorage.setItem("oauth_token", reply.oauth_token);
                localStorage.setItem("oauth_token_secret", reply.oauth_token_secret);
                console.log(localStorage.getItem("oauth_token_secret"));
                console.log("oauth_token: ", reply.oauth_token);
                console.log("oauth_token_secret: ", reply.oauth_token_secret);

                // gets the authorize screen URL
                cb.__call("oauth_authorize", {}, function(auth_url) {
                  console.log("auth_url: ", auth_url);
                  window.codebird_auth = window.open(auth_url);
                });
              }
            });
            //End OAuth
          });

        });

        //TODO MAKE A PIN FIELD
        /*
        cb.__call(
          "oauth_accessToken",
          { oauth_verifier: document.getElementById("PINFIELD").value },
          function(reply, rate, err) {
        	if (err) {
        	  console.log("error response or timeout exceeded" + err.error);
        	}
        	if (reply) {
        	  // store the authenticated token, which may be different from the request token (!)
        	  cb.setToken(reply.oauth_token, reply.oauth_token_secret);
        	}

        	// if you need to persist the login after page reload,
        	// consider storing the token in a cookie or HTML5 local storage
          }
        );
        
        */

      </script>
      <script>
        var modal = document.getElementById("modal");
        var btn = document.getElementById("post");
        var span = document.getElementsByClassName("close")[0];

        /*btn.onclick = function() {
          modal.style.display = "block";
        }*/

        span.onclick = function() {
          modal.style.display = "none";
        }

        window.onclick = function(event) {
          if (event.target == modal) {
            modal.style.display = "none";
          }
        }

        //Twitter stuff to be moved around
        //OAuth needs some magic to get working
        //https://developer.twitter.com/en/docs/basics/authentication/guides/log-in-with-twitter
        //https://github.com/jublo/codebird-js

      </script>
    </div>
  </div>
</body>

</html>
